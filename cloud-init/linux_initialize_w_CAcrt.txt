#cloud-config
runcmd:
  - echo 'Defaults:ec2-user !requiretty' >> /etc/sudoers.d/888-vagrant-cloud-init-requiretty
  - echo 'Defaults:centos !requiretty' >> /etc/sudoers.d/888-vagrant-cloud-init-requiretty
  - 'yum install -y epel-release'
  - 'yum update -y'
  - 'yum install -y python-pip'
  - 'pip install awscli'
  - echo "Setting up AWS" 
  - mkdir /root/.aws
  - echo '[default]' > /root/.aws/credentials
  - echo 'aws_secret_access_key = my_secret_key' >> /root/.aws/credentials
  - echo 'aws_access_key_id = my_access_key_id' >> /root/.aws/credentials
  # Copies and installs custom Certificate Authority from s3 bitbucket
  - 'aws s3 cp s3://<xyz_s3_bucket>/CA.crt /etc/pki/ca-trust/source/anchors/'
  - 'update-ca-trust enable'
  - 'update-ca-trust extract'
  # Copies ECS configuration and docker login information from s3 bitbucket
  - 'aws s3 cp s3://<xyz_s3_bucket>/dockercfg /root/.dockercfg'
  - echo '; generated by cloud-init ' > /etc/resolv.conf
  - echo 'nameserver xxx.xx.xx.xx' >> /etc/resolv.conf
  - echo 'xxx.xx.xx.xx host_name' >> /etc/hosts
